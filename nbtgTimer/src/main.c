/**
 * @file main.c
 *
 * @brief entry point for nbtgTimer
 */

//=====================================================================================================================
// Includes
//=====================================================================================================================

#include <FreeRTOS.h>
#include <task.h>

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>

#include "board.h"
#include "display.h"
#include "fstop.h"

//=====================================================================================================================
// Defines
//=====================================================================================================================

#define TASKMGR_TASK_STACK_SIZE 128

//=====================================================================================================================
// Globals
//=====================================================================================================================

static StaticTask_t tskMgrBuf;
static StackType_t  tskMgrStack[TASKMGR_TASK_STACK_SIZE * sizeof(StackType_t)];

const unsigned char logo [] = {
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x80, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x00, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xfe, 0x00, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xfc, 0x00, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xfc, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xf8, 0x00, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xf0, 0x00, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xc0, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xfe, 0x00, 0x00, 0x1b, 0xff, 0xff, 0xff, 0xff, 0xc3, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xe0, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0x83, 0xff, 0xff, 0x07, 0xff, 0xff, 0xff, 
    0xff, 0xe0, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0x83, 0xff, 0xff, 0x07, 0xff, 0xff, 0xff, 
    0xff, 0xee, 0x00, 0x00, 0x1b, 0xff, 0xff, 0xff, 0xff, 0x83, 0xff, 0xff, 0x07, 0xff, 0xff, 0xff, 
    0xff, 0xe0, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0x83, 0xff, 0xff, 0x07, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x83, 0xff, 0xff, 0x07, 0xff, 0xff, 0xff, 
    0xff, 0x3f, 0xff, 0xff, 0xfe, 0x3f, 0xff, 0xff, 0xff, 0x83, 0xff, 0xfe, 0x0f, 0xff, 0xff, 0xff, 
    0xfe, 0x3f, 0xff, 0xff, 0xf2, 0x3f, 0xff, 0xf1, 0xff, 0x83, 0x8f, 0xfe, 0x0f, 0xff, 0x1f, 0xff, 
    0xfe, 0x3f, 0xff, 0xff, 0xfe, 0x3f, 0xf0, 0x40, 0x7f, 0x06, 0x01, 0xf8, 0x01, 0xf8, 0x06, 0x0f, 
    0xfe, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xf0, 0x00, 0x3f, 0x00, 0x00, 0xf8, 0x01, 0xf0, 0x00, 0x0f, 
    0xfe, 0x3f, 0xff, 0xfe, 0xfe, 0x3f, 0xf0, 0x00, 0x1f, 0x00, 0x00, 0x78, 0x01, 0xe0, 0x00, 0x0f, 
    0xfe, 0x3f, 0x7b, 0xfc, 0xfe, 0x3f, 0xe0, 0x00, 0x1f, 0x00, 0x00, 0x78, 0x01, 0xc0, 0x00, 0x0f, 
    0xfe, 0x31, 0x09, 0x1c, 0xfe, 0x3f, 0xe0, 0x00, 0x1f, 0x00, 0x40, 0x38, 0x03, 0x80, 0x00, 0x1f, 
    0xfe, 0x35, 0x6a, 0xdc, 0x7e, 0x03, 0xe0, 0x3c, 0x1f, 0x03, 0xf0, 0x3e, 0x0f, 0x01, 0xf8, 0x1f, 
    0xfe, 0x25, 0x6a, 0xdc, 0x3e, 0x03, 0xe0, 0x7c, 0x1f, 0x07, 0xf8, 0x3c, 0x0f, 0x03, 0xf8, 0x1f, 
    0xfe, 0x25, 0x0a, 0x1c, 0x3e, 0x03, 0xe0, 0xfc, 0x1f, 0x07, 0xf8, 0x1c, 0x1f, 0x07, 0xfc, 0x1f, 
    0xfe, 0x3f, 0xff, 0x18, 0x3e, 0x03, 0xe0, 0xfc, 0x1e, 0x0f, 0xfc, 0x1c, 0x1e, 0x07, 0xfc, 0x1f, 
    0xfe, 0x3f, 0xfe, 0x38, 0x02, 0x03, 0xe0, 0xfc, 0x1e, 0x0f, 0xfc, 0x1c, 0x1e, 0x0f, 0xfc, 0x1f, 
    0xfe, 0x1f, 0xe0, 0x00, 0x00, 0x03, 0xe0, 0xfc, 0x1e, 0x0f, 0xfc, 0x1c, 0x1e, 0x0f, 0xfc, 0x1f, 
    0xfe, 0x3f, 0xff, 0xfb, 0xfe, 0x03, 0xc0, 0xfc, 0x1e, 0x0f, 0xf8, 0x3c, 0x1e, 0x0f, 0xfc, 0x1f, 
    0xfe, 0x3f, 0xe0, 0x03, 0xfc, 0x03, 0xc1, 0xfc, 0x1e, 0x0f, 0xf8, 0x3c, 0x1e, 0x07, 0xf8, 0x3f, 
    0xfe, 0x00, 0x00, 0x00, 0x00, 0x07, 0xc1, 0xfc, 0x1e, 0x07, 0xf0, 0x3c, 0x1f, 0x07, 0xf0, 0x3f, 
    0xfe, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xc1, 0xf8, 0x3e, 0x07, 0xe0, 0x38, 0x1f, 0x03, 0xe0, 0x3f, 
    0xfe, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xc1, 0xf8, 0x3e, 0x01, 0x80, 0x78, 0x3f, 0x00, 0x00, 0x3f, 
    0xfe, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xc1, 0xf8, 0x3c, 0x00, 0x00, 0xf8, 0x3f, 0x80, 0x00, 0x3f, 
    0xfe, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xc1, 0xf8, 0x3c, 0x00, 0x00, 0xf8, 0x3f, 0xc0, 0x00, 0x3f, 
    0xfe, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xc1, 0xf8, 0x3c, 0x00, 0x01, 0xf8, 0x3f, 0xe0, 0x00, 0x3f, 
    0xfe, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x81, 0xf8, 0x3c, 0x18, 0x07, 0xf8, 0x3f, 0xf0, 0x10, 0x7f, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x1f, 0xff, 0xff, 0xff, 0xf0, 0x7f, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xcf, 0xe0, 0x7f, 
    0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0xc0, 0x7f, 
    0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x01, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x01, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x07, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x1f, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff};

//=====================================================================================================================
// Functions
//=====================================================================================================================

void infinitelp(void *param)
{
    uint32_t times[12];

    getTimeTable(10100, false, 6, FSTOP_SIXTH, times);
    
    genererateTestStrip(10100, 12, FSTOP_THIRD, times);

    dispDrawBitmap((SPoint_t){0, 0}, logo, 128, 64, COLOR_WHITE);
    while(true)
    {
        vTaskDelay(1000);
    }
}


int main(void)
{
    initBoard();

    initDisplay(MODE_SPI);

    (void)xTaskCreateStatic(infinitelp, "inf", TASKMGR_TASK_STACK_SIZE, NULL, tskIDLE_PRIORITY + 1,
        &tskMgrStack[0], &tskMgrBuf);

    vTaskStartScheduler();
}